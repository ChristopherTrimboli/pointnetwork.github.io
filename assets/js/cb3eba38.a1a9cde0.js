"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[467],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return g}});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=o.createContext({}),u=function(e){var n=o.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return o.createElement(d.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(t),g=r,h=c["".concat(d,".").concat(g)]||c[g]||s[g]||a;return t?o.createElement(h,i(i({ref:n},p),{},{components:t})):o.createElement(h,i({ref:n},p))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=c;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var u=2;u<a;u++)i[u]=t[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},40397:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return d},metadata:function(){return u},toc:function(){return p},default:function(){return c}});var o=t(83117),r=t(80102),a=(t(67294),t(3905)),i=["components"],l={id:"debugging",title:"Debugging",sidebar_label:"Debugging",slug:"../debugging"},d=void 0,u={unversionedId:"general/debugging",id:"general/debugging",title:"Debugging",description:"Run a Point Network Node in a VS Code Debugger",source:"@site/docs/general/debugging.md",sourceDirName:"general",slug:"/debugging",permalink:"/docs/debugging",editUrl:"https://github.com/pointnetwork/pointnetwork.github.io/edit/main/website/docs/general/debugging.md",tags:[],version:"current",lastUpdatedBy:"Darren Jensen",lastUpdatedAt:1649663678,formattedLastUpdatedAt:"4/11/2022",frontMatter:{id:"debugging",title:"Debugging",sidebar_label:"Debugging",slug:"../debugging"},sidebar:"pnSidebar",previous:{title:"Troubleshooting",permalink:"/docs/troubleshooting"},next:{title:"Contributing",permalink:"/docs/contributing"}},p=[{value:"Run a Point Network Node in a VS Code Debugger",id:"run-a-point-network-node-in-a-vs-code-debugger",children:[],level:3},{value:"Sample launch.json file",id:"sample-launchjson-file",children:[],level:3},{value:"Debug Point Node in Docker Environment",id:"debug-point-node-in-docker-environment",children:[],level:3}],s={toc:p};function c(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h3",{id:"run-a-point-network-node-in-a-vs-code-debugger"},"Run a Point Network Node in a VS Code Debugger"),(0,a.kt)("p",null,"To debug the Point Network node in VS code:"),(0,a.kt)("p",null,"In your local pointnetowrk node folder, generate compiled typescript sourcemap files by running:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm run build -- --sourcemap\n")),(0,a.kt)("p",null,"This will create a ",(0,a.kt)("inlineCode",{parentName:"p"},"dist")," directory including ",(0,a.kt)("inlineCode",{parentName:"p"},"*.js.map")," files which are used by the VS Code debugger."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Open VS Code"),(0,a.kt)("li",{parentName:"ol"},"Open the Debugger tool"),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"create a launch.json"),' file (located under the blue "Run and Debug" button)'),(0,a.kt)("li",{parentName:"ol"},"Select 'Node JS' from the environment drop down"),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("inlineCode",{parentName:"li"},"configurations")," section of the ",(0,a.kt)("inlineCode",{parentName:"li"},"launch.json")," file add ",(0,a.kt)("inlineCode",{parentName:"li"},'"outputCapture": "std"')),(0,a.kt)("li",{parentName:"ol"},"Click the 'Play' icon next to 'Launch Program' dropdown on the top left"),(0,a.kt)("li",{parentName:"ol"},"Open a 'Debug Console' tab in VS Code and you will see the running Point Node logs"),(0,a.kt)("li",{parentName:"ol"},"Add a breakpoint to any part of the Point Node JS code (perhaps in the ",(0,a.kt)("inlineCode",{parentName:"li"},"abort404")," function of ",(0,a.kt)("inlineCode",{parentName:"li"},"ZProxy")," class)"),(0,a.kt)("li",{parentName:"ol"},"Open the Point Browser and navigate to a url that does not exist so that the breakpoint in the ",(0,a.kt)("inlineCode",{parentName:"li"},"abort404")," function will be hit."),(0,a.kt)("li",{parentName:"ol"},"Now you can inspect the variables in VS Code and use the debugger as usual."),(0,a.kt)("li",{parentName:"ol"},"Continue to add breakpoints where you need to assist with your debugging!")),(0,a.kt)("h3",{id:"sample-launchjson-file"},"Sample launch.json file"),(0,a.kt)("p",null,"Below is a sample ",(0,a.kt)("inlineCode",{parentName:"p"},"launch.json")," file that you can use. Its the same as the one generated by VS code with the ",(0,a.kt)("inlineCode",{parentName:"p"},"outputCaputure")," key added:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n    "version": "0.2.0",\n    "configurations": [\n        {\n            "type": "pwa-node",\n            "request": "launch",\n            "name": "Launch Program",\n            "skipFiles": [\n                "<node_internals>/**"\n            ],\n            "program": "${workspaceFolder}/point",\n            "outputCapture": "std"\n        }\n    ]\n}\n')),(0,a.kt)("h3",{id:"debug-point-node-in-docker-environment"},"Debug Point Node in Docker Environment"),(0,a.kt)("p",null,"If you have started Point Network using Docker environment then you will need to keep all the services running in Docker (Blockchain, Arweave etc) but you will also need to run the Point Node outside of Docker in VS Code so that you can attach a debugger to it. The way to do this is very simple:"),(0,a.kt)("p",null,"Its recommend to create a separate keystore and data directory for running the Point Node for debugging so that it does not interfere with any other environments that you are running. So therefore create a directory where you would like to use for this environments data and keys. I suggest calling it ",(0,a.kt)("inlineCode",{parentName:"p"},"devlocal"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"mkdir ~/devlocal\nmkdir ~/devlocal/keystore\n")),(0,a.kt)("p",null,"You need to copy the ",(0,a.kt)("inlineCode",{parentName:"p"},"blockchain-test-key.json")," mnemonic file from the Point Node repo to ",(0,a.kt)("inlineCode",{parentName:"p"},"devlocal/keystore/key.json")," so that it is used when starting the Node via the VS Code Debugger."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cp resources/blockchain-test-key.json ~/devlocal/keystore/key.json\n")),(0,a.kt)("p",null,"In the Point Node repo working directory create ",(0,a.kt)("inlineCode",{parentName:"p"},"config/devlocal.yaml")," file and add the following contents (note this file ",(0,a.kt)("strong",{parentName:"p"},"is ignored by Git")," so you do not commit this!):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"datadir: ~/devlocal\nwallet:\n  keystore_path: ~/devlocal/keystore\nmode: zappdev\nlog:\n  sendLogs: false\n  level: debug\nstorage:\n  arweave_host: localhost\n  arweave_protocol: http\n  arweave_port: 1984\n  use_arweave_bundler: false\n  use_arlocal: true\n  arweave_gateway_url: http://localhost:1984/graphql\nnetwork:\n  web3: http://localhost:7545\napi:\n  address: 127.0.0.1\nzproxy:\n  host: 127.0.0.1\n")),(0,a.kt)("p",null,"Create (or add to an existing) Debug configuration file like so (note the env key settings for ",(0,a.kt)("inlineCode",{parentName:"p"},"NODE_CONFIG_ENV")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"MODE"),"):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n    "version": "0.2.0",\n    "configurations": [\n        {\n            "type": "pwa-node",\n            "request": "launch",\n            "name": "Launch ZappDev",\n            "skipFiles": [\n                "<node_internals>/**"\n            ],\n            "program": "${workspaceFolder}/point",\n            "outputCapture": "std",\n            "env": {\n                "NODE_CONFIG_ENV": "devlocal",\n                "MODE": "zappdev"\n            }\n        }\n    ]\n}\n')),(0,a.kt)("p",null,"Continue to start the services and start the VS Code debugger like so:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"If you have not already done so, start the Point Node in Docker environment by following ",(0,a.kt)("a",{parentName:"li",href:"/docs/build-build-with-point-network"},"these instructions"),"."),(0,a.kt)("li",{parentName:"ol"},"Build the source code using sourcemaps option like so: ",(0,a.kt)("inlineCode",{parentName:"li"},"npm run build -- --sourcemap")),(0,a.kt)("li",{parentName:"ol"},"Start another node in VS Debugger using the ",(0,a.kt)("inlineCode",{parentName:"li"},"Launch ZappDev")," configuration that you have already added above."),(0,a.kt)("li",{parentName:"ol"},"Open ",(0,a.kt)("inlineCode",{parentName:"li"},"point-browser")," to test this (this is the browser where the proxy is set to ",(0,a.kt)("inlineCode",{parentName:"li"},"8666")," which is what the node will be running on since port mapping is not used here)."),(0,a.kt)("li",{parentName:"ol"},"Place break points in the code and debug!")))}c.isMDXComponent=!0}}]);